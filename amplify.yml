version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        # Export all required environment variables
        - export NEXT_PUBLIC_FIREBASE_API_KEY=$NEXT_PUBLIC_FIREBASE_API_KEY
        - export NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=$NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
        - export NEXT_PUBLIC_FIREBASE_PROJECT_ID=$NEXT_PUBLIC_FIREBASE_PROJECT_ID
        - export NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=$NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
        - export NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=$NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        - export NEXT_PUBLIC_FIREBASE_APP_ID=$NEXT_PUBLIC_FIREBASE_APP_ID
        - export FIREBASE_PROJECT_ID=$FIREBASE_PROJECT_ID
        - export FIREBASE_CLIENT_EMAIL=$FIREBASE_CLIENT_EMAIL
        - export FIREBASE_PRIVATE_KEY=$FIREBASE_PRIVATE_KEY
        - export GOOGLE_API_KEY=$GOOGLE_API_KEY
        - export GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
        - export GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET
        - export GOOGLE_REDIRECT_URI=$GOOGLE_REDIRECT_URI
        - export GOOGLE_SERVICE_ACCOUNT_EMAIL=$GOOGLE_SERVICE_ACCOUNT_EMAIL
        - export GOOGLE_PRIVATE_KEY=$GOOGLE_PRIVATE_KEY
        - export GOOGLE_REFRESH_TOKEN=$GOOGLE_REFRESH_TOKEN
        - export CLOUDINARY_CLOUD_NAME=$CLOUDINARY_CLOUD_NAME
        - export CLOUDINARY_API_KEY=$CLOUDINARY_API_KEY
        - export CLOUDINARY_API_SECRET=$CLOUDINARY_API_SECRET
        - export RESEND_API_KEY=$RESEND_API_KEY
        - export ADMIN_EMAIL=$ADMIN_EMAIL
        - export NODE_ENV=production
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=0, must-revalidate' 